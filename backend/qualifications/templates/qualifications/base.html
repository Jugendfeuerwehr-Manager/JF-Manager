{% extends 'home.html' %}
{% load crispy_forms_tags %}

{% block title %}{{ title|default:'Qualifikationen & Sonderaufgaben' }}{% endblock %}

{% block extra_css %}
<style>
.qualification-card {
    border-left: 4px solid #007bff;
}

.qualification-expired {
    border-left-color: #dc3545;
}

.qualification-expiring {
    border-left-color: #ffc107;
}

.special-task-active {
    border-left: 4px solid #28a745;
}

.special-task-completed {
    border-left: 4px solid #6c757d;
}

.stats-card {
    transition: transform 0.2s;
}

.stats-card:hover {
    transform: translateY(-2px);
}

.badge-status {
    font-size: 0.8em;
}

@media (max-width: 768px) {
    .desktop-only {
        display: none;
    }
}

@media (min-width: 769px) {
    .mobile-only {
        display: none;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-berechnung des Ablaufdatums
    const typeSelect = document.getElementById('id_type');
    const dateAcquiredInput = document.getElementById('id_date_acquired');
    const dateExpiresInput = document.getElementById('id_date_expires');
    
    if (typeSelect && dateAcquiredInput && dateExpiresInput) {
        function updateExpiryDate() {
            const typeId = typeSelect.value;
            const dateAcquired = dateAcquiredInput.value;
            
            if (typeId && dateAcquired) {
                fetch(`{% url 'qualifications:calculate_expiry_date' %}?type_id=${typeId}&date_acquired=${dateAcquired}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.expires && data.expiry_date) {
                            dateExpiresInput.value = data.expiry_date;
                            dateExpiresInput.readOnly = false;
                        } else {
                            dateExpiresInput.value = '';
                            dateExpiresInput.readOnly = true;
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        }
        
        typeSelect.addEventListener('change', updateExpiryDate);
        dateAcquiredInput.addEventListener('change', updateExpiryDate);
    }
    
    // Bootstrap Tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
    
    {% block content_header %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>{{ title|default:'Qualifikationen & Sonderaufgaben' }}</h1>
        {% block header_actions %}{% endblock %}
    </div>
    {% endblock %}
    
    {% block content_body %}{% endblock %}
</div>
{% endblock %}
